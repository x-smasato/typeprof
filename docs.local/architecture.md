# TypeProf アーキテクチャ概要

TypeProfは、Rubyコードを静的に解析して型情報を推論するためのツールです。このドキュメントでは、TypeProfの全体的なアーキテクチャと主要コンポーネントについて説明します。

## 全体アーキテクチャ

TypeProfは以下の主要コンポーネントから構成されています：

1. **AST（抽象構文木）システム**: Rubyコードを解析し、抽象構文木として表現します
2. **型システム**: 様々な型を表現し、型の互換性を判断します
3. **Boxシステム**: 型の流れと変更を追跡します
4. **環境システム**: 解析のコンテキストを管理します
5. **サービスレイヤー**: 解析プロセスを調整します
6. **CLIインターフェース**: コマンドライン操作を処理します
7. **LSP統合**: Language Server Protocolをサポートし、エディタとの連携を可能にします

## 処理フロー

TypeProfの基本的な処理フローは以下の通りです：

1. **コードの解析**: Rubyコードを解析してASTを生成します
2. **定義フェーズ**: ASTから型の環境（クラス、モジュール、メソッドなどの定義）を構築します
3. **インストールフェーズ**: 型の流れをモデル化するBoxを作成します
4. **実行フェーズ**: Boxを実行して型情報を伝播します
5. **出力フェーズ**: 推論された型情報をRBS形式で出力します

## データフロー

TypeProfの型推論は、型の流れをグラフとしてモデル化することで実現されています：

1. **Vertex**: 型変数を表すノード
2. **Edge**: 型の流れを表すエッジ
3. **Box**: 操作（メソッド呼び出しなど）を表すノード

型の流れは、ソースからシンクへの有向グラフとして表現されます。

## ファイル構造

TypeProfのコードベースは以下のような構造になっています：

- `lib/typeprof/core/ast/`: AST関連のコード
- `lib/typeprof/core/type.rb`: 型システムの定義
- `lib/typeprof/core/graph/`: グラフシステム（VertexとBox）
- `lib/typeprof/core/env/`: 環境システム
- `lib/typeprof/core/service.rb`: サービスレイヤー
- `lib/typeprof/cli/`: CLIインターフェース
- `lib/typeprof/lsp/`: LSP統合

各コンポーネントの詳細については、対応するドキュメントを参照してください。
